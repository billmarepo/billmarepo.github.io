<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>目を鍛える遊び</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap"
          rel="stylesheet">

    <style>
      #guchaed {
          font-family: 'EB Garamond', serif;
          font-size: 850%;
      }
      .answer {
          font-family: monospace;
      }
      .toggle {
          margin: -12px 0;
      }
    </style>

    <script>
      let guchaed = '';
      let yuruPattern = /^[0-9A-Za-z]{0,18}$/;
      let digit = '0123456789';
      let letters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let universe = digit.repeat(2) + letters; // 分布を適当に

      let randomGenerate = (length) => Array.from(
          {length},
          _ => universe[Math.floor(Math.random() * universe.length)]
      ).join('');

      function generate() {
          // サーバサイドレンダリングとかも考えたけど、面倒なのでやめた。
          // 開発者ツールで答えを見たい人は見ればいい。
          //
          // どうやら開発者ツールなんか使わなくても、普通にコピペできるらしいです、ハハ
          let target = document.getElementById('guchaed');
          while (true) {
              guchaed = randomGenerate(12);
              target.innerHTML = guchaed;
              // とても雑な作り。WMWMWMWMWMWM のようなのが来てはみ出ないための措置。
              // 適切に幅を計算して、SVG のぐちゃぐちゃも動的に作れたらよかった。
              // たぶん規則的なぐちゃぐちゃなので JS で適当な幅ぶんだけ作るのはできそう。
              // iiiiiiiiiiii みたいなのが来て余りすぎると不恰好だし動的にしたい。
              if (target.clientWidth < 1150) break;
          }
      }

      function score() {
          let answer = document.getElementById('answer').value;
          let msg = document.getElementById('msg');
          if (answer.match(yuruPattern) === null) {
              msg.innerHTML = '<s>編集距離:</s> 0 点！ｗ';
          } else {
              msg.innerHTML = `編集距離: ${editDistance(answer, guchaed)}`;
          }
      }

      function editDistance(s, t) {
          let n = s.length;
          let m = t.length;
          let dp = Array.from(
              {length: n + 1}, _ => Array.from({length: m + 1}, _ => n + m)
          );
          let cost = (i, j) => (s[i] == t[j])? 0: 1;

          for (let i = 0; i <= n; ++i) dp[i][0] = i;
          for (let j = 0; j <= m; ++j) dp[0][j] = j;
          for (let i = 0; i <= n; ++i) {
              for (let j = 0; j <= m; ++j) {
                  if (j + 1 <= m) {
                      dp[i][j + 1] = Math.min(dp[i][j + 1], dp[i][j] + 1);
                  }
                  if (i + 1 <= n) {
                      dp[i + 1][j] = Math.min(dp[i + 1][j], dp[i][j] + 1);
                  }
                  if (i + 1 <= n && j + 1 <= m) {
                      dp[i + 1][j + 1] = Math.min(
                          dp[i + 1][j + 1],
                          dp[i][j] + (s[i] == t[j]? 0: 1)
                      );
                  }
              }
          }

          return dp[n][m];
      }

      function toggle() {
          let gucha = document.getElementById('gucha');
          let x = gucha.style['stroke-opacity'];
          gucha.style['stroke-opacity'] = (x == 1.0? 0.9: 1.0);
          for (let toggleButton of document.getElementsByClassName('toggle')) {
              s = toggleButton.innerHTML;
              toggleButton.innerHTML = (s == '🙈'? '🐵': '🙈');
          }
      }

      function disclose() {
          let gucha = document.getElementById('gucha');
          gucha.style['stroke-opacity'] = 0.9;
          for (let discloseButton of document.getElementsByTagName('button')) {
              discloseButton.disabled = true;
          }
          let msg = document.getElementById('msg');
          msg.innerHTML = `解答: <span class="answer">${guchaed}</span> <button class="toggle" onclick="toggle()">🙈</button>`;
      }
    </script>
  </head>

  <body>
    <h1>目を鍛える遊び</h1>

    <!-- <?xml version="1.0" encoding="UTF-8" standalone="no"?> -->
    <!-- Created with Inkscape (http://www.inkscape.org/) -->
    <svg
      version="1.1"
      id="svg2"
      xml:space="preserve"
      width="1183.70667"
      height="143.30667"
      viewBox="0 0 1183.70667 143.30667"
      sodipodi:docname="tmp.pdf"
      xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
      xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:svg="http://www.w3.org/2000/svg"
      onload="generate()">
      <defs id="defs6" />
      <sodipodi:namedview
        id="namedview4"
        pagecolor="#ffffff"
        bordercolor="#666666"
        borderopacity="1.0"
        inkscape:pageshadow="2"
        inkscape:pageopacity="0.0"
        inkscape:pagecheckerboard="0" />
      <text x="50" y="98" id="guchaed">helloj</text>
      <g id="g8" inkscape:groupmode="layer" inkscape:label="tmp" transform="matrix(1.3333333,0,0,-1.3333333,0,133.30667)">
        <g id="g10" transform="scale(0.1)">
          <path d="M 74.7148,499.91 C 98.3359,735.895 197.645,925.113 315.656,925.113 433.668,925.113 532.977,735.895 556.598,499.91 580.219,263.926 528.152,74.707 457.383,74.707 c -70.774,0 -122.836,189.219 -99.215,425.203 23.637,235.985 122.945,425.203 240.957,425.203 118.012,0 217.32,-189.218 240.941,-425.203 23.622,-235.984 -28.445,-425.203 -99.214,-425.203 -70.774,0 -122.84,189.219 -99.219,425.203 23.64,235.985 122.945,425.203 240.961,425.203 118.016,0 217.316,-189.218 240.946,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.773,0 -122.84,189.219 -99.218,425.203 23.64,235.985 122.948,425.203 240.958,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.63,235.985 122.94,425.203 240.95,425.203 118.02,0 217.33,-189.218 240.95,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.63,235.985 122.94,425.203 240.95,425.203 118.02,0 217.32,-189.218 240.95,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.63,235.985 122.94,425.203 240.95,425.203 118.02,0 217.33,-189.218 240.95,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.63,235.985 122.94,425.203 240.95,425.203 118.02,0 217.32,-189.218 240.94,-425.203 23.63,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.31,-189.218 240.94,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.63,235.985 122.94,425.203 240.95,425.203 118.02,0 217.32,-189.218 240.94,-425.203 23.63,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.21,425.203 23.63,235.985 122.94,425.203 240.95,425.203 118.02,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.78,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.83,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.31,-189.218 240.93,-425.203 23.63,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.02,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.02,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.78,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.44,-425.203 -99.21,-425.203 -70.78,0 -122.84,189.219 -99.22,425.203 23.64,235.985 122.95,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.84,189.219 -99.21,425.203 23.64,235.985 122.94,425.203 240.96,425.203 118.01,0 217.32,-189.218 240.94,-425.203 23.62,-235.984 -28.45,-425.203 -99.22,-425.203 -70.77,0 -122.84,189.219 -99.22,425.203 23.65,235.985 122.95,425.203 240.97,425.203 118.01,0 217.32,-189.218 240.93,-425.203"
                style="fill:none;stroke:#ff0000;stroke-width:134.441;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
                id="gucha" />
        </g>
      </g>
    </svg>

    <div>
      <input type="text" placeholder="^[0-9A-Za-z]{12}$" id="answer" class="answer">
      <button onclick="score()">採点</button>
      <button onclick="disclose()">開示</button>
    </div>
    <div style="margin-top: 12px">
      <span id="msg"><span style="color: rgba(0, 0, 0, 0.05);">がんばれー</span></span>
    </div>

    <h2>これはなに</h2>  
    <p>
      パスワードや非公開 URL などの大事な文字列をぐちゃっと塗って隠してインターネットに公開するのは危ないです。
      自分で読めるようになることで「確かに危ないな」と実感するための遊びです。
    </p>
    <!-- 
      フォントとか変えられるようにしてもいいかも。
      というかぐちゃぐちゃ部分ももっとぐちゃぐちゃっぽくできたらいいかも。

      「ぐちゃ」という名前は CAPTCHA となんとなく似ている。
      人間よりコンピュータの方が得意そうだけど。
    -->

    <h2>あそびかた</h2>
    <p>
      隠された文字を予想して入力します。
    </p>
    <p>
      <button onclick="score()">採点</button> を押すと編集距離が計算されます。一発で 0 にできたらえらいです。
      <button onclick="disclose()">開示</button> を押すとゲームオーバーです。
      <!--
        ゲームオーバーになるとあそびかた欄のボタンも disabled になることから、 
        あそびかた欄のボタンでも発火するのだと察せる。
      -->
    </p>
  </body>
</html>
